# –ú–æ–¥—É–ª—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (Contacts Module)

## –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –≤ CRM —Å–∏—Å—Ç–µ–º–µ. –û–Ω –∑–∞–º–µ–Ω—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ JSON –ø–æ–ª—è –≤ –ª–∏–¥–∞—Ö –∏ —Å–¥–µ–ª–∫–∞—Ö –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üéØ **–¢–∏–ø—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
- **–§–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞** (`person`) - –∫–ª–∏–µ–Ω—Ç—ã, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –ª–∏—Ü–∞
- **–ö–æ–º–ø–∞–Ω–∏–∏** (`company`) - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ø–∞—Ä—Ç–Ω–µ—Ä—ã

### üìä **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤**
- Website (–≤–µ–±-—Å–∞–π—Ç)
- Phone (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏)
- Email (—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞)  
- Referral (—Ä–µ—Ñ–µ—Ä–∞–ª—ã)
- Social Media (—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏)
- Advertising (—Ä–µ–∫–ª–∞–º–∞)
- Import (–∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö)
- Other (–¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

### üîç **–ë–æ–≥–∞—Ç–∞—è –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
- –ü–æ–ª–Ω–æ–µ –∏–º—è (–∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ—Ç—á–µ—Å—Ç–≤–æ)
- –î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ –∫–æ–º–ø–∞–Ω–∏—è
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã (–º–æ–±–∏–ª—å–Ω—ã–π, —Ä–∞–±–æ—á–∏–π)
- Email –∏ –≤–µ–±-—Å–∞–π—Ç
- –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å (JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ (Telegram, WhatsApp, LinkedIn –∏ –¥—Ä.)
- –¢–µ–≥–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è (customFields)

## API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```
GET    /api/contacts              - –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
GET    /api/contacts/:id          - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç –ø–æ ID
POST   /api/contacts              - –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
PATCH  /api/contacts/:id          - –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
DELETE /api/contacts/:id          - –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
```
GET /api/contacts?type=person          - –ü–æ —Ç–∏–ø—É
GET /api/contacts?source=website       - –ü–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É
GET /api/contacts?assignedTo=userId    - –ü–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É
GET /api/contacts?company=–Ω–∞–∑–≤–∞–Ω–∏–µ     - –ü–æ –∫–æ–º–ø–∞–Ω–∏–∏
GET /api/contacts?tag=vip             - –ü–æ —Ç–µ–≥—É
GET /api/contacts/search?q=–∑–∞–ø—Ä–æ—Å     - –ü–æ–∏—Å–∫
```

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```
GET    /api/contacts/recent           - –ù–µ–¥–∞–≤–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
GET    /api/contacts/inactive         - –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
GET    /api/contacts/stats            - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
GET    /api/contacts/duplicates       - –ü–æ–∏—Å–∫ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
PATCH  /api/contacts/:id/blacklist    - –î–æ–±–∞–≤–∏—Ç—å –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
PATCH  /api/contacts/:id/unblacklist  - –£–±—Ä–∞—Ç—å –∏–∑ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
PATCH  /api/contacts/:id/assign       - –ù–∞–∑–Ω–∞—á–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
PATCH  /api/contacts/:id/touch        - –û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –∫–æ–Ω—Ç–∞–∫—Ç–∞
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

### –°–≤—è–∑—å —Å–æ —Å–¥–µ–ª–∫–∞–º–∏
```typescript
// –í Deal entity —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å:
@Column({ nullable: true })
contactId?: string; // –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç

// –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ contact —Å—Ç–∞–ª–æ deprecated:
@Column('json', { nullable: true })
contact?: { name: string; email?: string; ... }; // Deprecated
```

### –°–≤—è–∑—å —Å –ª–∏–¥–∞–º–∏
–õ–∏–¥—ã —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è** - –æ–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç –º–æ–∂–µ—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ —Å–¥–µ–ª–æ–∫
2. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤–µ–∑–¥–µ
3. **–ë–æ–≥–∞—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - —Ç–µ–≥–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
5. **–ì–∏–±–∫–æ—Å—Ç—å** - –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è, —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏

### üîÑ **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–¥–µ–ª–∫–∏ —Å JSON –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ä–∞–±–æ—á–∏–º–∏
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤—É—é —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ `contactId`
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
```typescript
const contact = await contactsService.createContact({
  type: ContactType.PERSON,
  name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
  firstName: '–ò–≤–∞–Ω',
  lastName: '–ü–µ—Ç—Ä–æ–≤',
  email: 'ivan@company.ru',
  phone: '+7 (495) 123-45-67',
  company: '–û–û–û –ö–æ–º–ø–∞–Ω–∏—è',
  position: '–î–∏—Ä–µ–∫—Ç–æ—Ä',
  source: ContactSource.WEBSITE,
  tags: ['vip', 'decision_maker'],
  assignedTo: 'manager-id'
});
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
```typescript
const deal = await dealsService.createDeal({
  title: '–ü—Ä–æ–¥–∞–∂–∞ CRM —Å–∏—Å—Ç–µ–º—ã',
  contactId: contact.id, // –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–æ–Ω—Ç–∞–∫—Ç
  amount: 100000,
  currency: 'RUB',
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
});
```

### –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```typescript
// –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º
const found = await contactsService.searchContacts('–ü–µ—Ç—Ä–æ–≤');

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏
const companyContacts = await contactsService.getContactsByCompany('–û–û–û –ö–æ–º–ø–∞–Ω–∏—è');

// –ö–æ–Ω—Ç–∞–∫—Ç—ã –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
const inactive = await contactsService.getContactsWithoutActivity(30); // 30 –¥–Ω–µ–π
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

–°–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
1. `CreateContactsTable` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
2. `SeedTestContacts` - —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
3. `AddContactIdToDeals` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ –≤ —Ç–∞–±–ª–∏—Ü—É —Å–¥–µ–ª–æ–∫

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** - —Å–æ–∑–¥–∞—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–∏–¥–∞–º–∏** - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É contactId –≤ –º–æ–¥—É–ª—å –ª–∏–¥–æ–≤  
3. **–ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç** - –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏
4. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. **–ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
