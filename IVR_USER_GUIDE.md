# Руководство по использованию IVR модуля

## Быстрый старт

### Доступ к модулю
Модуль IVR доступен через боковое меню: `Меню → IVR`

### Основной интерфейс

Интерфейс разделен на три основные панели:
1. **Корневые элементы** (слева) - точки входа в IVR-систему
2. **Дочерние элементы** (центр) - подменю выбранного элемента
3. **Редактор** (справа) - форма редактирования элемента

## Работа с корневыми элементами

### Создание корневого элемента
1. Нажмите кнопку **"Добавить корень"** в правом верхнем углу
2. Заполните форму в редакторе справа
3. Нажмите **"Сохранить"**

### Редактирование элемента
1. Кликните на элемент в списке
2. Измените нужные поля в редакторе
3. Нажмите **"Сохранить"**

### Удаление элемента
1. Выберите элемент
2. Нажмите кнопку **"Удалить"** в редакторе или иконку корзины в списке
3. Подтвердите действие

### Изменение порядка
- Перетащите элемент за иконку **☰** (три полоски) на новую позицию
- Порядок сохраняется автоматически

## Работа с дочерними элементами (Древовидная структура)

### ⭐ НОВОЕ: Неограниченная вложенность
Теперь каждый дочерний элемент может иметь свои дочерние элементы, создавая многоуровневое дерево!

### Создание дочернего элемента
**Вариант 1:** Через заголовок панели
1. Выберите родительский элемент в левой панели (корневые элементы)
2. Нажмите кнопку **"+"** в заголовке средней панели
3. Заполните форму и сохраните

**Вариант 2:** Через действия узла
1. Выберите корневой элемент
2. В дереве наведите на узел, к которому хотите добавить ребенка
3. Нажмите кнопку **"+"** (Add) в действиях узла
4. Элемент будет создан как дочерний для выбранного узла

### Создание многоуровневой структуры
Пример создания подменю:
1. Создайте корневой элемент "Главное меню"
2. Добавьте к нему дочерний "Техподдержка"
3. Выберите "Техподдержка" в дереве
4. Добавьте к нему детей: "Общие вопросы", "Критичные вопросы"
5. Выберите "Общие вопросы"
6. Добавьте к нему детей: "FAQ", "Инструкции"

Результат:
```
Главное меню
└── Техподдержка
    ├── Общие вопросы
    │   ├── FAQ
    │   └── Инструкции
    └── Критичные вопросы
```

### Навигация по дереву
- **Стрелка (>)** - разворачивает/сворачивает ветку
- **Клик на узел** - выбирает элемент для редактирования
- **Hover на узел** - показывает действия (Add, Edit, Delete)
- **Отступы слева** - показывают уровень вложенности
- **Счетчик** - показывает количество прямых детей ("3 элемента")

## Типы действий (Actions)

### Menu (Меню)
Интерактивное меню с вариантами выбора
- **Использование**: Основное меню IVR
- **Медиа**: Укажите аудиофайл с приветствием
- **Дочерние элементы**: Варианты выбора по клавишам

### Playback (Воспроизведение)
Воспроизведение аудиосообщения
- **Использование**: Информационные сообщения
- **Медиа**: Обязательно укажите аудиофайл
- **Payload**: Заполняется автоматически при выборе медиа

### Dial (Набор номера)
Переадресация на номер телефона
- **Использование**: Переадресация на оператора
- **Payload**: Номер телефона или SIP-адрес

### Goto (Перейти)
Переход к другому узлу IVR
- **Использование**: Навигация между меню
- **Payload**: ID узла назначения

### Hangup (Завершить)
Завершение звонка
- **Использование**: Конец диалога
- **Настройки**: Дополнительных параметров не требует

### Queue (Очередь)
Постановка в очередь к операторам
- **Использование**: Ожидание свободного оператора
- **Очередь**: Выберите очередь из списка

## Работа с медиафайлами

### Загрузка аудиофайла
1. В секции "Медиа" нажмите **"Выбрать файл"**
2. Выберите WAV-файл (макс. 8 МБ)
3. Нажмите **"Загрузить"**
4. Файл появится в списке доступных медиа

### Выбор медиафайла
1. В выпадающем списке "Выбрать медиафайл" выберите нужный файл
2. Payload заполнится автоматически

### Управление медиафайлами
- **Переименовать**: Нажмите иконку карандаша
- **Удалить**: Нажмите иконку корзины

## Настройка параметров

### Основные параметры

**Название** - Понятное название узла (обязательно)

**Действие** - Тип действия узла (обязательно)

**Клавиша** - DTMF клавиша для навигации (0-9, *, #)
- Используется для дочерних элементов в меню
- Каждая клавиша должна быть уникальной в пределах одного меню

### Расширенные параметры

**Таймаут (мс)** - Время ожидания ввода клавиши (по умолчанию 5000 мс)

**Клавиша "назад"** - Клавиша для возврата в предыдущее меню

**Клавиша повтора** - Клавиша для повторного воспроизведения меню

**Клавиша корня** - Клавиша для перехода в главное меню

**Разрешить ранний DTMF** - Позволить прерывать воспроизведение нажатием клавиши

### Webhook интеграция

**Webhook URL** - URL для отправки данных при выполнении действия

**Метод HTTP** - GET, POST или PUT

Использование:
- Логирование действий пользователя
- Интеграция с внешними системами
- Динамическая генерация контента

## Советы и рекомендации

### Структура IVR
1. **Главное меню** - корневой элемент с типом "menu"
2. **Варианты выбора** - дочерние элементы с клавишами
3. **Действия** - конечные узлы (dial, hangup, queue)

### Хорошие практики

✅ **DO:**
- Используйте понятные названия узлов
- Ограничивайте количество вариантов в меню (макс. 5-7)
- Всегда предоставляйте возможность вернуться назад
- Тестируйте IVR после каждого изменения

❌ **DON'T:**
- Не создавайте слишком глубокую вложенность (макс. 3-4 уровня)
- Не используйте одинаковые клавиши в одном меню
- Не забывайте про timeout - пользователь может не успеть нажать

### Примерная структура

```
Главное меню (корень)
├── 1 → Техподдержка (dial)
├── 2 → Отдел продаж (queue)
├── 3 → Информация (menu)
│   ├── 1 → Часы работы (playback)
│   ├── 2 → Адрес (playback)
│   └── 0 → Назад (goto)
└── 0 → Повторить (goto)
```

## Горячие клавиши

- **Click** - Выбрать элемент
- **Drag** - Изменить порядок
- **Enter** (в форме) - Сохранить изменения

## Устранение неполадок

### Элемент не сохраняется
- Проверьте обязательные поля (название, действие)
- Убедитесь, что payload указан для действий dial/goto/playback
- Проверьте, что клавиша соответствует формату (0-9, *, #)

### Медиафайл не загружается
- Проверьте формат файла (только WAV)
- Убедитесь, что размер файла не превышает 8 МБ
- Проверьте кодировку аудио (рекомендуется 8000 Hz, 16 bit, mono)

### Не отображаются дочерние элементы
- Убедитесь, что выбран родительский элемент
- Обновите страницу (кнопка "Обновить" в заголовке)

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера (F12) на наличие ошибок
2. Обновите страницу
3. Свяжитесь с администратором системы

---

**Версия документа**: 1.0  
**Дата обновления**: 23 октября 2025
