<app-page-layout
  title="Кампании уведомлений"
  [subtitle]="'Всего: ' + campaigns().length + ' кампаний'"
>
  <div page-actions>
    <button mat-raised-button color="primary" routerLink="/notifications/campaigns/new">
      <mat-icon>add</mat-icon>
      Создать кампанию
    </button>
    <button mat-stroked-button [matMenuTriggerFor]="filterMenu">
      <mat-icon>filter_list</mat-icon>
      Фильтры
    </button>
  </div>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else if (campaigns().length === 0) {
    <div class="empty-state">
      <mat-icon>campaign</mat-icon>
      <h3>Нет кампаний</h3>
      <p>Создайте первую кампанию для рассылки уведомлений</p>
      <button mat-raised-button color="primary" routerLink="/notifications/campaigns/new">
        <mat-icon>add</mat-icon>
        Создать кампанию
      </button>
    </div>
  } @else {
    <div class="modern-table-container">
      <div class="table-wrapper">
        <table mat-table [dataSource]="campaigns()" class="modern-table">
          
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Название</th>
            <td mat-cell *matCellDef="let campaign">
              <div class="campaign-name">
                <strong>{{ campaign.name }}</strong>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="channel">
            <th mat-header-cell *matHeaderCellDef>Канал</th>
            <td mat-cell *matCellDef="let campaign">
              <div class="channel-badge" [class]="'channel-' + campaign.channel.toLowerCase()">
                <mat-icon>{{ getChannelIcon(campaign.channel) }}</mat-icon>
                <span>{{ campaign.channel }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Статус</th>
            <td mat-cell *matCellDef="let campaign">
              <span class="status-badge" [class]="'status-' + campaign.status">
                {{ getStatusLabel(campaign.status) }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="progress">
            <th mat-header-cell *matHeaderCellDef>Прогресс</th>
            <td mat-cell *matCellDef="let campaign">
              <div class="progress-info">
                <span>{{ campaign.sentCount }} / {{ campaign.totalRecipients }}</span>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="(campaign.sentCount / campaign.totalRecipients) * 100"></div>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="scheduledAt">
            <th mat-header-cell *matHeaderCellDef>Запланировано</th>
            <td mat-cell *matCellDef="let campaign">
              {{ campaign.scheduledAt ? (campaign.scheduledAt | date:'dd.MM.yyyy HH:mm') : '—' }}
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="actions-column">Действия</th>
            <td mat-cell *matCellDef="let campaign" class="actions-column">
              @if (campaign.status === 'draft') {
                <button mat-icon-button (click)="startCampaign(campaign)" matTooltip="Запустить">
                  <mat-icon>play_arrow</mat-icon>
                </button>
              }
              @if (campaign.status === 'running') {
                <button mat-icon-button (click)="pauseCampaign(campaign)" matTooltip="Приостановить">
                  <mat-icon>pause</mat-icon>
                </button>
              }
              <button mat-icon-button [routerLink]="['/notifications/campaigns', campaign.id]" matTooltip="Редактировать">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button [routerLink]="['/notifications/campaigns', campaign.id, 'stats']" matTooltip="Статистика">
                <mat-icon>bar_chart</mat-icon>
              </button>
              <button mat-icon-button [matMenuTriggerFor]="actionMenu" matTooltip="Еще">
                <mat-icon>more_vert</mat-icon>
              </button>
              
              <mat-menu #actionMenu="matMenu">
                <button mat-menu-item (click)="deleteCampaign(campaign)">
                  <mat-icon>delete</mat-icon>
                  <span>Удалить</span>
                </button>
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
        </table>
      </div>
    </div>
  }

  <mat-menu #filterMenu="matMenu">
    <button mat-menu-item>
      <mat-icon>filter_list</mat-icon>
      <span>По статусу</span>
    </button>
    <button mat-menu-item>
      <mat-icon>swap_vert</mat-icon>
      <span>По дате</span>
    </button>
  </mat-menu>
</app-page-layout>
