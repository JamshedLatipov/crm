<app-page-layout
  [title]="'Управление категориями скриптов'"
  subtitle="Создавайте и управляйте категориями для организации скриптов звонков"
>
  <div page-actions>
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <button mat-raised-button color="primary" (click)="openCreateCategoryDialog()">
      <mat-icon>add</mat-icon>
      Создать категорию
    </button>
  </div>
</app-page-layout>

<!-- Page Content -->
<div class="page-content">
  <div class="content-wrapper">
    <!-- Search Section -->
    <div class="search-section">
      <div class="search-card">
        <mat-icon class="search-icon">search</mat-icon>
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Поиск категорий</mat-label>
          <input
            matInput
            [(ngModel)]="searchQuery"
            (input)="filterCategories()"
            placeholder="Введите название категории"
          />
        </mat-form-field>
      </div>
    </div>

    <!-- Categories Table Section -->
    <div class="table-section">
      <div class="section-card">
        <div class="section-header">
          <mat-icon class="section-icon">category</mat-icon>
          <h3 class="section-title">Список категорий</h3>
        </div>

        <div class="table-container">
          <crm-table
            [columns]="columns"
            [data]="tableData"
            [pageSize]="10"
          >
            <ng-template crmColumnTemplate="nameTemplate" let-row>
              <div class="category-name-cell">
                <div class="color-indicator" [style.background-color]="row.color || '#6366f1'"></div>
                <span class="name-text">{{ row.name }}</span>
              </div>
            </ng-template>

            <ng-template crmColumnTemplate="statusTemplate" let-row>
              <mat-chip
                [class]="'status-chip ' + (row.isActive ? 'active' : 'inactive')"
              >
                {{ row.isActive ? 'Активна' : 'Неактивна' }}
              </mat-chip>
            </ng-template>

            <ng-template crmColumnTemplate="actionsTemplate" let-row>
              <div class="actions-cell">
                <button class="edit-btn" [attr.data-category-id]="row.id" title="Редактировать" (click)="onTableActionClick($event)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button class="delete-btn" [attr.data-category-id]="row.id" title="Удалить" (click)="onTableActionClick($event)">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </ng-template>
          </crm-table>
        </div>

        <div *ngIf="filteredCategories().length === 0" class="empty-state">
          <mat-icon class="empty-icon">category</mat-icon>
          <h3>{{ searchQuery ? 'Категории не найдены' : 'Категорий пока нет' }}</h3>
          <p *ngIf="!searchQuery">Создайте первую категорию для организации скриптов</p>
        </div>
      </div>
    </div>
  </div>
</div>