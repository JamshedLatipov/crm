<div class="flex items-center gap-2">
  <button
    mat-button
    [matMenuTriggerFor]="statusMenu"
    aria-label="Статус агента"
    class="flex items-center gap-2 px-3 py-1.5 rounded-lg hover:bg-white/10 transition-all"
  >
    <!-- Status dot with color and optional pulse -->
    <span
      class="status-dot"
      [class.pulse]="shouldPulse()"
      [style.background-color]="currentStatusInfo().color"
    ></span>

    <!-- Status icon -->
    <mat-icon
      class="status-menu-icon"
      [style.color]="currentStatusInfo().color"
    >
      {{ currentStatusInfo().icon }}
    </mat-icon>

    <!-- Status label -->
    <span 
      class="status-text"
      [class.call-active]="callActive()"
    >
      {{ currentStatusInfo().label }}
      @if (reason()) {
        <span class="text-xs opacity-75"> — {{ reason() }}</span>
      }
    </span>

    <!-- Dropdown arrow -->
    <mat-icon style="font-size: 18px; width: 18px; height: 18px;">
      arrow_drop_down
    </mat-icon>
  </button>

  <!-- Status menu -->
  <mat-menu
    #statusMenu="matMenu"
    [overlapTrigger]="false"
    class="status-menu"
  >
    <div class="px-4 py-2 text-xs text-gray-600 font-medium uppercase tracking-wide">
      Выберите статус
    </div>
    <mat-divider></mat-divider>

    <!-- All status options -->
    @for (statusOption of allStatuses; track statusOption.value) {
      <button 
        mat-menu-item 
        (click)="selectStatus(statusOption.value)"
        [disabled]="statusOption.value === agentStatus()"
      >
        <div class="status-menu-item">
          <!-- Status dot -->
          <span
            class="status-dot"
            [style.background-color]="statusOption.color"
          ></span>

          <!-- Status icon -->
          <mat-icon
            class="status-menu-icon"
            [style.color]="statusOption.color"
          >
            {{ statusOption.icon }}
          </mat-icon>

          <!-- Status label -->
          <span class="flex-1">{{ statusOption.label }}</span>

          <!-- Checkmark for current status -->
          @if (statusOption.value === agentStatus()) {
            <mat-icon class="status-menu-icon text-green-500">
              check
            </mat-icon>
          }
        </div>
      </button>
    }
  </mat-menu>
</div>
