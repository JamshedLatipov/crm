# Система управления пользователями CRM

## Обзор

Полноценная система управления пользователями для CRM-системы, реализованная на Angular 18+ с использованием signals, standalone компонентов и Material UI.

## Архитектура

### Сервис управления пользователями (`UserManagementService`)

Центральный сервис для управления пользователями с реактивным состоянием:

- **Реактивное состояние**: Использует Angular signals для управления состоянием
- **CRUD операции**: Полный набор операций создания, чтения, обновления и удаления
- **Фильтрация и поиск**: Гибкая система фильтрации по ролям, статусу, департаменту
- **Пагинация**: Встроенная поддержка пагинации
- **Статистика**: Автоматический подсчет статистики пользователей
- **Экспорт данных**: Возможность экспорта в различные форматы

### Компоненты

#### 1. UserListComponent
Основной компонент для отображения списка пользователей с расширенным функционалом:

**Функции:**
- Табличное представление с сортировкой
- Поиск по имени, email, телефону
- Фильтрация по ролям, статусу, департаменту
- Пагинация
- Множественный выбор и групповые операции
- Экспорт данных

**Материалы:**
- MatTableModule для таблицы
- MatPaginatorModule для пагинации
- MatCheckboxModule для выбора
- MatChipsModule для фильтров

#### 2. UserFormComponent
Форма создания и редактирования пользователей:

**Функции:**
- Режимы создания и редактирования
- Валидация форм с TypeScript типизацией
- Управление ролями с чекбоксами
- Динамическое добавление навыков и территорий
- Настройка рабочих параметров (нагрузка, руководитель)
- Конфигурируемые поля пароля для режима создания

**Материалы:**
- ReactiveFormsModule для форм
- MatSelectModule для выбора
- MatSliderModule для настройки нагрузки
- MatAutocompleteModule для автодополнения

#### 3. UserDetailComponent
Детальное представление пользователя:

**Функции:**
- Вкладочный интерфейс с обзором, активностью, производительностью
- Отображение ролей, навыков, территорий
- Действия с пользователем (редактирование, деактивация, удаление)
- Информация о руководителе
- Статистика и показатели

**Материалы:**
- MatTabsModule для вкладок
- MatMenuModule для действий
- MatBadgeModule для статусов

#### 4. UsersComponent
Корневой компонент с маршрутизацией

## Типы данных

### User Interface
```typescript
interface User {
  id: number;
  username: string;
  email: string;
  firstName?: string;
  lastName?: string;
  phone?: string;
  department?: string;
  roles: string[];
  isActive: boolean;
  isAvailableForAssignment: boolean;
  maxLeadsCapacity: number;
  managerID?: number;
  skills?: string[];
  territories?: string[];
  createdAt: Date;
  updatedAt: Date;
}
```

### Доступные роли
- `admin` - Администратор
- `sales_manager` - Менеджер продаж
- `senior_manager` - Старший менеджер
- `team_lead` - Руководитель команды
- `account_manager` - Менеджер аккаунтов
- `client` - Клиент

## Маршрутизация

```typescript
/users              -> UserListComponent (список пользователей)
/users/create       -> UserFormComponent (создание пользователя)
/users/:id          -> UserDetailComponent (детали пользователя)
/users/:id/edit     -> UserFormComponent (редактирование пользователя)
```

## Установка и настройка

### 1. Импорт в приложение

Маршруты автоматически подключены в `app.routes.ts`:

```typescript
{
  path: 'users',
  canActivate: [authGuard],
  children: usersRoutes
}
```

### 2. Навигационное меню

Добавлен пункт меню в sidebar:

```typescript
{ icon: 'group', label: 'Users', route: '/users' }
```

### 3. Зависимости

Используются следующие Angular Material модули:
- MatTableModule
- MatPaginatorModule
- MatFormFieldModule
- MatInputModule
- MatSelectModule
- MatCheckboxModule
- MatChipsModule
- MatButtonModule
- MatIconModule
- MatMenuModule
- MatTabsModule
- MatCardModule
- MatSnackBarModule
- MatProgressSpinnerModule
- MatSliderModule
- MatAutocompleteModule

## Использование

### Основные операции

1. **Просмотр списка пользователей**: Переход на `/users`
2. **Создание пользователя**: Кнопка "Добавить пользователя" или `/users/create`
3. **Редактирование**: Клик по пользователю → кнопка "Редактировать"
4. **Удаление**: Меню действий → "Удалить"
5. **Групповые операции**: Выбор нескольких пользователей → кнопка действий

### Фильтрация и поиск

- **Поиск**: Ввод в поле поиска (поиск по имени, email, телефону)
- **Фильтр по ролям**: Выбор ролей в выпадающем меню
- **Фильтр по статусу**: Активные/неактивные пользователи
- **Фильтр по департаменту**: Выбор департамента

### Экспорт данных

Доступны форматы:
- CSV
- Excel
- PDF
- JSON

## Расширение функциональности

### Добавление новых ролей

1. Обновить массив `availableRoles` в `UserFormComponent`
2. Добавить перевод в `roleLabels` в `UserDetailComponent`
3. Обновить цветовую схему в методе `getRoleColor`

### Добавление новых полей

1. Обновить интерфейс `User` в сервисе
2. Добавить поля в форму (`UserFormComponent`)
3. Обновить отображение в `UserDetailComponent`
4. Обновить таблицу в `UserListComponent` при необходимости

### Интеграция с бэкендом

Сервис готов для интеграции с HTTP API. Замените моковые данные на реальные HTTP-запросы:

```typescript
// Пример интеграции
getUsers(): Observable<User[]> {
  return this.http.get<User[]>('/api/users');
}

createUser(userData: CreateUserRequest): Observable<User> {
  return this.http.post<User>('/api/users', userData);
}
```

## Безопасность

- Все маршруты защищены `authGuard`
- Валидация данных на клиенте
- Типизация TypeScript для предотвращения ошибок
- Санитизация пользовательского ввода через Angular Material

## Производительность

- Использование OnPush change detection
- Сигналы для минимизации пересчетов
- Ленивая загрузка с пагинацией
- Оптимизированные фильтры

## Тестирование

Компоненты готовы для unit-тестирования:
- Все зависимости инжектируются через DI
- Публичные методы для тестирования
- Моковые данные для изоляции тестов

## Будущие улучшения

1. **Аналитика**: Интеграция с системой аналитики производительности
2. **Уведомления**: Push-уведомления о изменениях пользователей
3. **Аудит**: Система логирования действий пользователей
4. **Импорт**: Массовый импорт пользователей из файлов
5. **Права доступа**: Более гранулярная система разрешений