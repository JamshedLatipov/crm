<app-page-layout 
  title="Настройки системы" 
  subtitle="Управление основными параметрами системы">
  
  <div page-actions>
    <button
      mat-raised-button
      color="primary"
      (click)="initializeDefaults()"
      [disabled]="loading()"
      matTooltip="Инициализировать настройки из .env файла"
    >
      <mat-icon>settings_backup_restore</mat-icon>
      Инициализировать из .env
    </button>
  </div>

  <div class="settings-container">
    <mat-tab-group class="settings-tabs" animationDuration="300ms">
      <!-- Вкладка: Цены кампаний -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">attach_money</mat-icon>
          Цены кампаний
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-header>
              <mat-card-title>Стоимость сообщений</mat-card-title>
              <mat-card-subtitle>
                Настройте стоимость отправки сообщений для каждого канала
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <form [formGroup]="campaignPricingForm" class="pricing-form">
                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>SMS ({{ '' | currencySymbol }} за сообщение)</mat-label>
                    <mat-icon matPrefix>sms</mat-icon>
                    <input matInput type="number" step="0.01" formControlName="smsCost" />
                    <mat-hint>Стоимость отправки одного SMS</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Email ({{ '' | currencySymbol }} за сообщение)</mat-label>
                    <mat-icon matPrefix>email</mat-icon>
                    <input matInput type="number" step="0.01" formControlName="emailCost" />
                    <mat-hint>Стоимость отправки одного Email</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>WhatsApp ({{ '' | currencySymbol }} за сообщение)</mat-label>
                    <mat-icon matPrefix>chat</mat-icon>
                    <input matInput type="number" step="0.01" formControlName="whatsappCost" />
                    <mat-hint>Стоимость отправки одного WhatsApp сообщения</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Telegram ({{ '' | currencySymbol }} за сообщение)</mat-label>
                    <mat-icon matPrefix>send</mat-icon>
                    <input matInput type="number" step="0.01" formControlName="telegramCost" />
                    <mat-hint>Стоимость отправки одного Telegram сообщения</mat-hint>
                  </mat-form-field>
                </div>

                <div class="form-actions">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="saveCampaignPricing()"
                    [disabled]="loading() || campaignPricingForm.invalid"
                  >
                    <mat-icon>save</mat-icon>
                    Сохранить цены
                  </button>
                  <button
                    mat-stroked-button
                    (click)="resetCampaignPricing()"
                    [disabled]="loading()"
                  >
                    <mat-icon>refresh</mat-icon>
                    Сбросить
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Вкладка: Общие настройки -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">business</mat-icon>
          Общие
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-header>
              <mat-card-title>Информация о компании</mat-card-title>
              <mat-card-subtitle>
                Основные данные вашей компании
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <form [formGroup]="generalSettingsForm" class="general-form">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Название компании</mat-label>
                  <mat-icon matPrefix>business</mat-icon>
                  <input matInput formControlName="companyName" />
                </mat-form-field>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Email компании</mat-label>
                    <mat-icon matPrefix>email</mat-icon>
                    <input matInput type="email" formControlName="companyEmail" />
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="form-field">
                    <mat-label>Телефон компании</mat-label>
                    <mat-icon matPrefix>phone</mat-icon>
                    <input matInput type="tel" formControlName="companyPhone" />
                  </mat-form-field>
                </div>

                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Часовой пояс</mat-label>
                  <mat-icon matPrefix>schedule</mat-icon>
                  <input matInput formControlName="timezone" />
                </mat-form-field>

                <div class="form-actions">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="saveGeneralSettings()"
                    [disabled]="loading() || generalSettingsForm.invalid"
                  >
                    <mat-icon>save</mat-icon>
                    Сохранить
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Вкладка: Валюта -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">payments</mat-icon>
          Валюта
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-header>
              <mat-card-title>Настройки валюты</mat-card-title>
              <mat-card-subtitle>
                Выберите валюту для отображения цен в системе
              </mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <form [formGroup]="currencySettingsForm" class="currency-form">
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Код валюты</mat-label>
                  <mat-icon matPrefix>account_balance</mat-icon>
                  <input matInput formControlName="defaultCurrency" />
                  <mat-hint>Код валюты (RUB, USD, EUR, TJS, KZT, KGS, UZS)</mat-hint>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Символ валюты</mat-label>
                  <mat-icon matPrefix>currency_exchange</mat-icon>
                  <input matInput formControlName="currencySymbol" />
                  <mat-hint>Символ для отображения (₽, $, €, SM, ₸, с, so'm)</mat-hint>
                </mat-form-field>

                <div class="currency-examples">
                  <h4>Примеры:</h4>
                  <div class="example-item">
                    <strong>RUB:</strong> ₽ (Российский рубль)
                  </div>
                  <div class="example-item">
                    <strong>USD:</strong> $ (Доллар США)
                  </div>
                  <div class="example-item">
                    <strong>EUR:</strong> € (Евро)
                  </div>
                  <div class="example-item">
                    <strong>TJS:</strong> SM (Таджикский сомони)
                  </div>
                  <div class="example-item">
                    <strong>KZT:</strong> ₸ (Казахский тенге)
                  </div>
                  <div class="example-item">
                    <strong>KGS:</strong> с (Киргизский сом)
                  </div>
                  <div class="example-item">
                    <strong>UZS:</strong> so'm (Узбекский сум)
                  </div>
                </div>

                <div class="form-actions">
                  <button
                    mat-raised-button
                    color="primary"
                    (click)="saveCurrencySettings()"
                    [disabled]="loading() || currencySettingsForm.invalid"
                  >
                    <mat-icon>save</mat-icon>
                    Сохранить
                  </button>
                  <button
                    mat-stroked-button
                    (click)="resetCurrencySettings()"
                    [disabled]="loading()"
                  >
                    <mat-icon>refresh</mat-icon>
                    Сбросить
                  </button>
                </div>
              </form>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Вкладка: Дополнительные поля -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">tune</mat-icon>
          Дополнительные поля
        </ng-template>
        
        <div class="tab-content tab-content-no-card">
          <app-custom-fields></app-custom-fields>
        </div>
      </mat-tab>

      <!-- Вкладка: Уведомления (заглушка) -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">notifications</mat-icon>
          Уведомления
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-content>
              <div class="empty-state">
                <mat-icon>notifications_off</mat-icon>
                <p>Настройки уведомлений будут доступны позже</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>

      <!-- Вкладка: Безопасность (заглушка) -->
      <mat-tab>
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">security</mat-icon>
          Безопасность
        </ng-template>
        
        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-content>
              <div class="empty-state">
                <mat-icon>shield</mat-icon>
                <p>Настройки безопасности будут доступны позже</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</app-page-layout>
