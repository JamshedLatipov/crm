<app-page-layout title="Настройки каналов" icon="settings">
  <div class="settings-container">
    <div class="settings-header">
      <button
        mat-raised-button
        color="primary"
        (click)="initializeDefaults()"
        [disabled]="loading()"
      >
        <mat-icon>settings_backup_restore</mat-icon>
        Инициализировать из .env
      </button>
    </div>

    <mat-tab-group class="settings-tabs" [animationDuration]="200">
      <mat-tab *ngFor="let category of categories" [label]="category.label">
        <ng-template mat-tab-label>
          <mat-icon class="tab-icon">{{ category.icon }}</mat-icon>
          {{ category.label }}
        </ng-template>

        <div class="tab-content">
          <mat-card class="settings-card">
            <mat-card-header>
              <mat-card-title>{{ category.label }} настройки</mat-card-title>
              <button 
                mat-raised-button 
                color="primary" 
                class="add-button"
                (click)="openCreateDialog(category.value)"
              >
                <mat-icon>add</mat-icon>
                Добавить
              </button>
            </mat-card-header>
            <mat-card-content>
              <div class="settings-list">
                <div
                  *ngFor="let setting of getSettingsByCategory(category.value)"
                  class="setting-item"
                >
                  <div class="setting-key">{{ setting.key }}</div>
                  <div class="setting-value">
                    {{ setting.isSecret ? '••••••••' : setting.value || '(не задано)' }}
                  </div>
                  <div class="setting-actions">
                    <button 
                      mat-icon-button 
                      color="primary"
                      (click)="openEditDialog(setting)"
                      matTooltip="Редактировать"
                    >
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button 
                      mat-icon-button 
                      color="warn"
                      (click)="deleteSetting(setting.key)"
                      matTooltip="Удалить"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>

                <div
                  *ngIf="getSettingsByCategory(category.value).length === 0"
                  class="empty-state"
                >
                  <mat-icon>info</mat-icon>
                  <p>Настройки для этой категории отсутствуют</p>
                  <button 
                    mat-button 
                    color="primary"
                    (click)="openCreateDialog(category.value)"
                  >
                    <mat-icon>add</mat-icon>
                    Добавить настройку
                  </button>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </mat-tab>
    </mat-tab-group>

    <div *ngIf="loading()" class="loading-overlay">
      <mat-icon class="spinner">sync</mat-icon>
    </div>
  </div>
</app-page-layout>
