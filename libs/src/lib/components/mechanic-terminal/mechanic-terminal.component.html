<div class="mechanic-terminal">
  @if (!authenticated()) {
    <!-- Login Screen -->
    <div class="login-screen">
      <div class="login-card">
        <div class="login-header">
          <div class="icon">üîß</div>
          <h1>–¢–µ—Ä–º–∏–Ω–∞–ª –º–µ—Ö–∞–Ω–∏–∫–∞</h1>
          <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à PIN-–∫–æ–¥</p>
        </div>

        <div class="pin-input-container">
          <input
            type="password"
            class="pin-input"
            [(ngModel)]="pinInput"
            (keyup.enter)="login()"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            maxlength="6"
            autofocus
          />
        </div>

        @if (error()) {
          <div class="error-message">
            {{ error() }}
          </div>
        }

        <button class="login-btn" (click)="login()" [disabled]="pinInput().length < 4">
          –í–æ–π—Ç–∏
        </button>

        <div class="login-hint">
          <small>–ú–∏–Ω–∏–º—É–º 4 —Ü–∏—Ñ—Ä—ã</small>
        </div>
      </div>
    </div>
  } @else {
    <!-- Main Terminal -->
    <div class="terminal-screen">
      <!-- Header -->
      <div class="terminal-header">
        <div class="header-left">
          <div class="mechanic-info">
            <div class="mechanic-avatar">{{ currentMechanic()?.name?.charAt(0) || '?' }}</div>
            <div class="mechanic-details">
              <div class="mechanic-name">{{ currentMechanic()?.name }}</div>
              <div class="mechanic-id">ID: {{ currentMechanic()?.id }}</div>
            </div>
          </div>
        </div>
        <div class="header-right">
          <button class="refresh-btn" (click)="loadOrders()" [disabled]="loading()">
            üîÑ {{ loading() ? '–ó–∞–≥—Ä—É–∑–∫–∞...' : '–û–±–Ω–æ–≤–∏—Ç—å' }}
          </button>
          <button class="logout-btn" (click)="logout()">
            üö™ –í—ã—Ö–æ–¥
          </button>
        </div>
      </div>

      <div class="terminal-content">
        <!-- My Active Orders -->
        <div class="section">
          <div class="section-header">
            <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã ({{ myOrders().length }})</h2>
          </div>

          @if (myOrders().length === 0) {
            <div class="empty-state">
              <div class="empty-icon">üìã</div>
              <p>–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
              <p class="empty-hint">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∏–∂–µ</p>
            </div>
          } @else {
            <div class="orders-grid">
              @for (order of myOrders(); track order.id) {
                <div class="order-card active">
                  <div class="order-header">
                    <div class="order-number">
                      <span class="number">{{ order.queueNumber }}</span>
                      <span class="zone-badge">{{ order.zone }}</span>
                    </div>
                    <div class="order-timer">
                      ‚è±Ô∏è {{ getTimerDisplay(order.id) }}
                    </div>
                  </div>

                  <div class="order-body">
                    <div class="vehicle-info">
                      <div class="vehicle-make">{{ order.vehicleMake }} {{ order.vehicleModel }}</div>
                      <div class="license-plate">{{ order.licensePlate }}</div>
                    </div>

                    <div class="work-info">
                      <div class="work-type">{{ order.workType }}</div>
                      @if (order.workDescription) {
                        <div class="work-desc">{{ order.workDescription }}</div>
                      }
                    </div>

                    <div class="customer-info">
                      <div class="customer-name">üë§ {{ order.customerName }}</div>
                      <div class="customer-phone">üìû {{ order.customerPhone }}</div>
                    </div>
                  </div>

                  <div class="order-actions">
                    <button class="btn btn-success" (click)="completeOrder(order)" [disabled]="loading()">
                      ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å
                    </button>
                    <button class="btn btn-danger" (click)="blockOrder(order)" [disabled]="loading()">
                      üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>

        <!-- Available Orders -->
        <div class="section">
          <div class="section-header">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–∫–∞–∑—ã ({{ filteredAvailable().length }})</h2>
            <div class="zone-filter">
              <label>–ó–æ–Ω–∞:</label>
              <select [(ngModel)]="selectedZone" class="zone-select">
                @for (zone of availableZones(); track zone) {
                  <option [value]="zone">{{ zone }}</option>
                }
              </select>
            </div>
          </div>

          @if (filteredAvailable().length === 0) {
            <div class="empty-state">
              <div class="empty-icon">‚ú®</div>
              <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p>
              @if (selectedZone() !== 'ALL') {
                <p class="empty-hint">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∑–æ–Ω—É</p>
              }
            </div>
          } @else {
            <div class="orders-list">
              @for (order of filteredAvailable(); track order.id) {
                <div class="order-row">
                  <div class="order-info">
                    <div class="order-number-col">
                      <span class="queue-num">{{ order.queueNumber }}</span>
                      <span class="zone-badge">{{ order.zone }}-{{ order.queueNumberInZone }}</span>
                    </div>

                    <div class="vehicle-col">
                      <div class="vehicle-name">{{ order.vehicleMake }} {{ order.vehicleModel }}</div>
                      <div class="license-plate-small">{{ order.licensePlate }}</div>
                    </div>

                    <div class="work-col">
                      <div class="work-type-text">{{ order.workType }}</div>
                      @if (order.workDescription) {
                        <div class="work-desc-small">{{ order.workDescription }}</div>
                      }
                    </div>

                    <div class="priority-col">
                      <span class="priority-badge" [class]="getPriorityBadgeClass(order.priority)">
                        {{ order.priority }}
                      </span>
                    </div>

                    <div class="time-col">
                      <div class="time-label">–°–æ–∑–¥–∞–Ω:</div>
                      <div class="time-value">{{ order.createdAt | date:'HH:mm' }}</div>
                    </div>
                  </div>

                  <div class="order-action">
                    <button class="btn btn-primary" (click)="takeOrder(order)" [disabled]="loading()">
                      –í–∑—è—Ç—å
                    </button>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
