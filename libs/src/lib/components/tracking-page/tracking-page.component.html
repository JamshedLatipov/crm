<div class="tracking-container">
  <div class="tracking-card">
    <!-- Header -->
    <div class="card-header">
      <h1 class="title">–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
      <div class="auto-refresh">
        <label class="switch">
          <input type="checkbox" [checked]="autoRefresh()" (change)="toggleAutoRefresh()">
          <span class="slider"></span>
        </label>
        <span class="refresh-label">–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading() && !trackingInfo()) {
      <div class="loading-state">
        <div class="spinner"></div>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="error-state">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p class="error-message">{{ error() }}</p>
        <button class="retry-btn" (click)="loadTrackingInfo()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
      </div>
    }

    <!-- Tracking Info -->
    @if (trackingInfo(); as info) {
      <div class="tracking-content">
        <!-- Status Banner -->
        <div class="status-banner" [class]="statusClass()">
          <div class="status-icon">
            @switch (info.status) {
              @case ('WAITING') { <span>‚è≥</span> }
              @case ('IN_PROGRESS') { <span>üîß</span> }
              @case ('COMPLETED') { <span>‚úÖ</span> }
              @case ('CANCELLED') { <span>‚ùå</span> }
              @case ('BLOCKED') { <span>üö´</span> }
            }
          </div>
          <div class="status-text">
            <h2>{{ statusText() }}</h2>
            <p class="queue-number">–ù–æ–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥–∏: #{{ info.queueNumber }}</p>
          </div>
        </div>

        <!-- Current Position (only for WAITING) -->
        @if (info.status === 'WAITING') {
          <div class="position-card">
            <div class="position-number">{{ info.currentPosition }}</div>
            <div class="position-label">–ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏</div>
            <div class="estimated-time">
              <span class="clock-icon">üïê</span>
              –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: <strong>{{ info.estimatedWaitMinutes }} –º–∏–Ω</strong>
            </div>
          </div>
        }

        <!-- Order Details -->
        <div class="details-section">
          <h3 class="section-title">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
          
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">–ó–æ–Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</span>
              <span class="detail-value zone-badge">{{ info.zone }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">–ù–æ–º–µ—Ä –≤ –∑–æ–Ω–µ</span>
              <span class="detail-value">{{ info.zone }}-{{ info.queueNumberInZone }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">–ê–≤—Ç–æ–º–æ–±–∏–ª—å</span>
              <span class="detail-value">{{ info.vehicleMake }} {{ info.vehicleModel }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">–¢–∏–ø —Ä–∞–±–æ—Ç</span>
              <span class="detail-value">{{ info.workType }}</span>
            </div>
            
            <div class="detail-item">
              <span class="detail-label">–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è</span>
              <span class="detail-value">{{ info.createdAt | date:'dd.MM.yyyy HH:mm' }}</span>
            </div>
            
            @if (info.startedAt) {
              <div class="detail-item">
                <span class="detail-label">–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç</span>
                <span class="detail-value">{{ info.startedAt | date:'dd.MM.yyyy HH:mm' }}</span>
              </div>
            }
            
            @if (info.completedAt) {
              <div class="detail-item">
                <span class="detail-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                <span class="detail-value">{{ info.completedAt | date:'dd.MM.yyyy HH:mm' }}</span>
              </div>
            }
          </div>
        </div>

        <!-- Actions -->
        <div class="actions-section">
          @if (canCancel()) {
            <button class="cancel-btn" (click)="cancelOrder()" [disabled]="loading()">
              –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          }
          
          <button class="refresh-btn" (click)="loadTrackingInfo()" [disabled]="loading()">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>

        <!-- Info Message -->
        @if (info.status === 'WAITING') {
          <div class="info-message">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <p>–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –≤–∞—à –∞–≤—Ç–æ–º–æ–±–∏–ª—å –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤.</p>
          </div>
        }
        
        @if (info.status === 'COMPLETED') {
          <div class="success-message">
            <span class="success-icon">üéâ</span>
            <p>–í–∞—à –∞–≤—Ç–æ–º–æ–±–∏–ª—å –≥–æ—Ç–æ–≤! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥—ä–µ–∑–∂–∞–π—Ç–µ –≤ –∑–æ–Ω—É {{ info.zone }}.</p>
          </div>
        }
      </div>
    }
  </div>
</div>
