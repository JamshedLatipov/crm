<div class="qr-join-container">
  @if (!success()) {
    <!-- Form -->
    <div class="join-card">
      <div class="card-header">
        <div class="icon">üöó</div>
        <h1>–ó–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥—å</h1>
        @if (queueInfo()) {
          <div class="zone-info">
            <span class="zone-badge">–ó–æ–Ω–∞ {{ queueInfo()!.zone }}</span>
            <span class="wait-time">‚è±Ô∏è ~{{ queueInfo()!.estimatedWaitMinutes }} –º–∏–Ω</span>
          </div>
        }
      </div>

      @if (loading() && !queueInfo()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
        </div>
      }

      @if (error()) {
        <div class="error-banner">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span class="error-text">{{ error() }}</span>
        </div>
      }

      @if (queueInfo()) {
        <form class="join-form" (ngSubmit)="submitForm()">
          <!-- Contact Information -->
          <div class="form-section">
            <h3 class="section-title">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            
            <div class="form-group">
              <label class="required">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
              <input
                type="tel"
                class="form-input"
                [(ngModel)]="phone"
                name="phone"
                placeholder="+992 XX XXX XXXX"
                required
              />
              <small class="form-hint">–î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</small>
            </div>

            <div class="form-group">
              <label>–ò–º—è</label>
              <input
                type="text"
                class="form-input"
                [(ngModel)]="customerName"
                name="customerName"
                placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
              />
            </div>
          </div>

          <!-- Vehicle Information -->
          <div class="form-section">
            <h3 class="section-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ–º–æ–±–∏–ª–µ</h3>
            
            <div class="form-group">
              <label>–ú–∞—Ä–∫–∞</label>
              <input
                type="text"
                class="form-input"
                [(ngModel)]="vehicleMake"
                name="vehicleMake"
                placeholder="Toyota"
              />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>–ú–æ–¥–µ–ª—å</label>
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="vehicleModel"
                  name="vehicleModel"
                  placeholder="Camry"
                />
              </div>

              <div class="form-group">
                <label>–ì–æ–¥</label>
                <input
                  type="number"
                  class="form-input"
                  [(ngModel)]="vehicleYear"
                  name="vehicleYear"
                  [min]="1990"
                  [max]="maxYear"
                />
              </div>
            </div>

            <div class="form-group">
              <label>–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
              <input
                type="text"
                class="form-input license-input"
                [(ngModel)]="licensePlate"
                name="licensePlate"
                placeholder="AA 1234 BB"
                maxlength="10"
              />
            </div>
          </div>

          <!-- Work Type -->
          <div class="form-section">
            <h3 class="section-title">–¢–∏–ø —Ä–∞–±–æ—Ç</h3>
            
            <div class="form-group">
              <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É</label>
              <select
                class="form-select"
                [(ngModel)]="workType"
                name="workType"
              >
                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                @for (type of queueInfo()!.availableWorkTypes; track type) {
                  <option [value]="type">{{ getWorkTypeLabel(type) }}</option>
                }
              </select>
            </div>

            <div class="form-group">
              <label>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
              <textarea
                class="form-textarea"
                [(ngModel)]="workDescription"
                name="workDescription"
                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∑–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—Ä–º–æ–∑–æ–≤"
                rows="3"
              ></textarea>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="form-actions">
            <button
              type="submit"
              class="submit-btn"
              [disabled]="!formValid() || loading()"
            >
              @if (loading()) {
                <span class="btn-spinner"></span>
                <span>–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
              } @else {
                <span>üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –≤ –æ—á–µ—Ä–µ–¥—å</span>
              }
            </button>
          </div>

          <div class="form-footer">
            <small>
              * - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è<br>
              –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            </small>
          </div>
        </form>
      }
    </div>
  } @else {
    <!-- Success Screen -->
    <div class="success-card">
      <div class="success-icon-large">‚úÖ</div>
      <h1 class="success-title">–í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ã!</h1>
      
      <div class="success-info">
        <div class="info-item">
          <div class="info-label">–í–∞—à –Ω–æ–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥–∏</div>
          <div class="info-value queue-number">{{ successData()!.queueNumber }}</div>
        </div>

        @if (queueInfo()) {
          <div class="info-item">
            <div class="info-label">–ó–æ–Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è</div>
            <div class="info-value">{{ queueInfo()!.zone }}</div>
          </div>
        }

        <div class="info-item">
          <div class="info-label">–ü—Ä–∏–º–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è</div>
          <div class="info-value">{{ successData()!.estimatedWaitMinutes }} –º–∏–Ω—É—Ç</div>
        </div>
      </div>

      <div class="success-message">
        <span class="message-icon">üì±</span>
        <p>–í—ã –ø–æ–ª—É—á–∏—Ç–µ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –≤–∞—à –∞–≤—Ç–æ–º–æ–±–∏–ª—å –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤</p>
      </div>

      <div class="success-actions">
        @if (successData()!.orderId) {
          <button class="btn btn-primary" (click)="trackOrder()">
            üîç –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å
          </button>
        }
        <button class="btn btn-secondary" (click)="resetForm()">
          ‚ûï –ó–∞–ø–∏—Å–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª—å
        </button>
      </div>
    </div>
  }
</div>
