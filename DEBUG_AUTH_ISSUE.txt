# üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú–´ 401 UNAUTHORIZED

## –ü—Ä–æ–±–ª–µ–º–∞
GET http://localhost:3000/api/messages/telegram/templates?page=1&limit=20
–°—Ç–∞—Ç—É—Å: **401 (Unauthorized)**

## –ü—Ä–∏—á–∏–Ω–∞
Backend controller —Ç—Ä–µ–±—É–µ—Ç JWT —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ `@UseGuards(JwtAuthGuard)`

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
–û—Ç–∫—Ä—ã—Ç—å DevTools Console –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
```javascript
localStorage.getItem('crm_auth')
```

–ï—Å–ª–∏ `null` ‚Üí **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω**

### 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å AuthInterceptor
**–§–∞–π–ª:** `apps/front/src/app/auth/auth.interceptor.ts`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `app.config.ts`

**–õ–æ–≥–∏–∫–∞:**
- –ë–µ—Ä—ë—Ç —Ç–æ–∫–µ–Ω –∏–∑ `authService.getToken()`
- –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ URL —Å–æ–¥–µ—Ä–∂–∏—Ç `/api/`

### 3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Backend Guard
**–§–∞–π–ª:** `apps/back/src/app/modules/messages/controllers/telegram-template.controller.ts`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `@UseGuards(JwtAuthGuard)`

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:**
```typescript
@Controller('messages/telegram/templates')
@UseGuards(JwtAuthGuard)  // <-- –¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
@ApiBearerAuth()
export class TelegramTemplateController {
```

## –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç –ê: –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è
1. –û—Ç–∫—Ä—ã—Ç—å `/login`
2. –í–≤–µ—Å—Ç–∏ credentials
3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage

### –í–∞—Ä–∏–∞–Ω—Ç –ë: –£–±—Ä–∞—Ç—å Guard (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
**–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** –¥–ª—è production

–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ controller:
```typescript
// @UseGuards(JwtAuthGuard)
```

### –í–∞—Ä–∏–∞–Ω—Ç –í: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞
–¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –∏—Å—Ç–µ—á—å. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ DevTools Console:
```javascript
const data = JSON.parse(localStorage.getItem('crm_auth'));
if (data.exp) {
  const isExpired = Date.now() / 1000 > data.exp;
  console.log('Token expired:', isExpired);
  console.log('Expires at:', new Date(data.exp * 1000));
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º:
```bash
curl -H "Authorization: Bearer <YOUR_TOKEN>" \
  http://localhost:3000/api/messages/telegram/templates?page=1&limit=20
```

### –ó–∞–ø—Ä–æ—Å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 401):
```bash
curl http://localhost:3000/api/messages/telegram/templates?page=1&limit=20
```

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω?
- [ ] –¢–æ–∫–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ localStorage?
- [ ] –¢–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç—ë–∫?
- [ ] AuthInterceptor –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω?
- [ ] Backend controller –∏—Å–ø–æ–ª—å–∑—É–µ—Ç JwtAuthGuard?
- [ ] URL –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç `/api/`?

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–û—Ç–∫—Ä—ã—Ç—å Network tab –≤ DevTools:
1. –ù–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å –∫ `/api/messages/telegram/templates`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **Request Headers**
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer eyJ...`

–ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ frontend (AuthInterceptor)
–ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –µ—Å—Ç—å ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ backend (JwtAuthGuard/token validation)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage –≤ –±—Ä–∞—É–∑–µ—Ä–µ
